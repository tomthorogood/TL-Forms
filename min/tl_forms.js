if(typeof navigator!=="undefined"){var IE_MODE=navigator.appName==="Microsoft Internet Explorer"}String.prototype.toTitleCase=function(){var a=/^(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|vs?\.?|via)$/i;return this.replace(/([^\W_]+[^\s\-]*) */g,function(c,e,b,d){if(b>0&&b+e.length!==d.length&&e.search(a)>-1&&d.charAt(b-2)!==":"&&d.charAt(b-1).search(/[^\s\-]/)<0){return c.toLowerCase()}if(e.substr(1).search(/[A-Z]|\../)>-1){return c}return c.charAt(0).toUpperCase()+c.substr(1)})};function Parse(a){if(/::/.test(a)){return a.split(/::/g)}return[a,a]}function allow_progress(g,c){var a=false;var b={};var d;for(var f=0;f<g.elements.length;f++){element=g.elements[f];if(f===0){d=element.name}else{if(d!==element.name){if(!b[d]){break}else{d=element.name}}}if(typeof b[element.name]==="undefined"){b[element.name]=element.valid}else{if(b[element.name]===true){continue}else{b[element.name]=element.valid}}if(f===g.elements.length-1&&typeof b[element.name]!=="undefined"){console.debug("testing last element");console.debug("this element is "+b[element.name]);switch(b[element.name]){case true:$(c).show();break;default:$(c).hide();break}break}}}function Form(){this.parse={value:function(a){return Parse(a)[0]},display:function(a){return Parse(a)[1]},selected:function(a){return Parse(a)[2]}}}Form.prototype.IE_Compliant=function(a){if(IE_MODE){var b=document.createElement("div");b.name=a.name;b.appendChild(a);return b}return a};Form.prototype.create_text_field=function(a,c,b){if(typeof a==="undefined"){a="text_field"}var d=document.createElement("input");d.type="text";d.name=a;d.value=c||"";if(typeof b==="string"){$(d).addClass(b)}return this.IE_Compliant(d)};Form.prototype.create_dropdown_menu=function(b,a,d,f){var h=document.createElement("select");if(typeof b==="undefined"){b="dropdown"}h.name=b;for(var e in a){if(typeof e!=="undefined"){var g=a[e];if(!f||typeof f==="undefined"){g=g.replace(/_/g," ").toTitleCase()}var c=document.createElement("option");c.value=this.parse.value(g);c.innerHTML=this.parse.display(g);h.appendChild(c)}}if(typeof d==="string"){$(h).addClass(d)}return h};Form.prototype.create_password_field=function(a,c,b){if(typeof a==="undefined"){a="password"}var d=document.createElement("input");d.type="password";d.name=a;if(typeof c==="string"){d.value=c}if(typeof b==="string"){$(d).addClass(b)}return this.IE_Compliant(d)};Form.prototype.create_submit_button=function(a,d,c,e){var b;if(typeof d==="undefined"){d="Submit"}if(typeof e==="undefined"){b=document.createElement("input");b.type="submit";b.value=d}else{b=document.createElement("input");b.type="image";b.src=e}if(typeof c==="string"){$(b).addClass(c)}b.name=a||"submit";return this.IE_Compliant(b)};Form.prototype.create_hidden_field=function(a,c){var b=document.createElement("input");b.type="hidden";b.name=a;b.value=c;return b};Form.prototype.create_file_upload=function(b,c){var a=document.createElement("input");a.type="file";a.name=b;if(typeof c==="string"){$(a).addClass(c)}return this.IE_Compliant(a)};Form.create_textarea=function(b,d,c){var a=document.createElement("textarea");if(typeof b==="undefined"){b="textarea"}if(typeof c==="string"){$(a).addClass(c)}if(typeof d==="string"){a.innerHTML=d}return this.IE_Compliant(a)};Form.prototype.create_multi_button=function(c,i,b,g){var a=document.createElement("div");var h;a.name=c;for(h in i){if(typeof h==="string"){var f=document.createElement("div");var j=document.createElement("span");if(typeof b==="string"){$(f).addClass(b)}var e=document.createElement("input");if(typeof c==="undefined"){c=g}e.name=c;e.type=g;e.value=this.parse.value(i[h]);if(this.parse.selected(i[h])==="Selected"){e.checked="checked"}j.innerHTML=this.parse.display(i[h]);f.appendChild(e);f.appendChild(j);a.appendChild(f)}}return a};Form.prototype.create_radio_button=function(b,a,c){return this.create_multi_button(b,a,c,"radio")};Form.prototype.create_checkbox=function(b,a,c){return this.create_multi_button(b,a,c,"checkbox")};function Form_Bridge(){this.creator=new Form()}Form_Bridge.prototype.create_text_field=function(a,c,b){return this.creator.create_text_field(a,c,b)};Form_Bridge.prototype.create_password_field=function(a,c,b){return this.creator.create_password_field(a,c,b)};Form_Bridge.prototype.create_hidden_field=function(a,b){return this.creator.create_hidden_field(a,b)};Form_Bridge.prototype.create_dropdown_menu=function(b,a,c){return this.creator.create_dropdown_menu(b,a,c)};Form_Bridge.prototype.create_submit_button=function(a,c,b){return this.creator.create_submit_button(a,c,b)};Form_Bridge.prototype.create_radio_button=function(a,c,b){return this.creator.create_radio_button(a,c,b)};Form_Bridge.prototype.create_textarea=function(a,c,b){return this.creator.create_textarea(a,c,b)};function Element(c,a,f,d,h,g){this.form_creator=new Form_Bridge();this.type=c;this.input=[];this.name=a;this.validator=typeof h!=="undefined"?h:undefined;this.validation_lives=false;this.required=typeof g!=="undefined"?g:false;this.valid=!(typeof this.validator!=="undefined"&&this.required===true);switch(this.type){case"text":this.model=this.form_creator.create_text_field(a,f,d);this.tag="input";break;case"hidden":this.model=this.form_creator.create_hidden_field(a,f);this.tag="input";break;case"password":this.model=this.form_creator.create_password_field(a,f,d);this.tag="input";break;case"dropdown":this.model=this.form_creator.create_dropdown_menu(a,f,d);this.tag="select";break;case"submit":this.model=this.form_creator.create_submit_button(a,f,d);this.tag="input";break;case"radio":this.model=this.form_creator.create_radio_button(a,f,d);this.tag="input";break;case"textarea":this.model=this.form_creator.create_textarea(a,f,d);this.tag="textarea"}var e=(this.model.getElementsByTagName(this.tag));for(var b=0;b<e.length;b++){this.input.push(e[b])}if(e.length===0){this.input.push(this.model)}}Element.prototype.assign_callback=function(a){this.validator_callback=a};Element.prototype.live_validation=function(a){this.validation_lives=true;if(typeof a!=="undefined"){this.validator_callback=a}if(typeof this.validator!=="undefined"){this.validator.validate(this,this.validator_callback)}};function Field_Group(a,c){this.elements=c;this.inputs=[];this.field_names=[];this.div=document.createElement("div");$(this.div).addClass("tl form group").hide();for(var b=0;b<c.length;b++){this.div.appendChild(c[b].model);this.inputs.push(c[b].input);this.field_names.push(c[b].name)}}function Validator(b,a,e,d,c){this.ANIMATION_SPEED=e||250;this.DELAY=a||650;this.css={valid:d||{"background-color":"#00afad",color:"#fff"},invalid:c||{"background-color":"#811",color:"#fff"}};this.test=b;this.set_text={}}Validator.prototype.validate=function(d,g){var b=this;var f;var e;if(d.type.toLowerCase()==="radio"){for(var c=0;c<d.input.length;c++){$(d.input[c]).change(function(){var h=this.value;e=b.test(h);d.valid=e;if(typeof g==="function"){return function(){g()}()}})}}else{var a=d.input[0];$(a).keyup(function(){$(this).one("keydown",function(h){if(h.keyCode!==9){clearTimeout(f)}});if(typeof a.value!=="undefined"&&a.value.length>0){f=setTimeout(function(){e=b.test(a.value);switch(typeof e){case"object":b.set_text[d.name]=e[1].toString();e=e[0];case"boolean":var h=e?b.css.valid:b.css.invalid;d.valid=e;break;default:e=true;d.valid=e}$(a).animate(h,b.ANIMATION_SPEED,function(){if(typeof b.set_text[d.name]==="string"){a.value=b.set_text[d.name];delete b.set_text[d.name]}});if(typeof g==="function"){return function(){g()}()}},b.DELAY)}})}};function Form_Widget(d,c,b,a){if(!b===true){this.overlay=new Overlay();this.element=this.overlay.div}else{this.element=a}this.ANIMATION_SPEED=150;this.method=d;this.handler=c;this.fields=[];this.groups=[];this.validation_timeout=500;this.field_instructions={};this.swap_char_map={_x_:"d"};this.valid={email:new Validator(function(h){var g=/[A-Za-z0-9%._\-]*@[A-Zz-z0-9\-]*\.[a-zA-Z0-9]{2,4}/gi;var f;var e;if(g.test(h)){f=true}switch(f){case true:return true;case false:return[false,"That email address already exists in our system."];default:return false}}),day_in_month:new Validator(function(e){var f=parseInt(e,10);return(typeof f==="number"&&f<32)}),currency:new Validator(function(h){var g=/^\$?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/;var i=g.test(h);if(i){var f=/[$,]/g;var e=h.replace(f,"");return[true,e]}else{return g.test(i)}}),percentage:new Validator(function(h){var g=/^[0-9]{0,2}\.{0,1}[0-9]{0,2}%{0,1}/;var e=/^(\.(\d*))/;var f;if(e.test(h)){as_float=parseFloat(h,10);if(as_float>1){return[true,as_float/100]}return true}else{if(g.test(h)){var f=parseInt(h.replace(/\%/g,""),10);f/=100;return[true,f]}else{return false}}}),password:new Validator(function(f){var e=/\\\/\(\)\{\};/g;var g=6;if(!e.test(f)){if(f.length>=g){return true}else{return false}}else{return false}}),no_digits:new Validator(function(f){var e=/\d.*/;return !e.test(f)})}}Form_Widget.prototype.add_field=function(b){var c;if(typeof b.valid_as!=="undefined"){b.test=this.valid[b.valid_as]}var a=new Element(b.type,b.name,b.value,b.css,b.test,b.required);this.fields.push(a)};Form_Widget.prototype.grouping=function(j,d){var a;var f;var h;var i=[];for(var a=0;a<d.length;a++){f=this.field_index(d[a]);i.push(this.fields[f])}this.groups.push(new Field_Group(j,i));var k=this.groups.length-1;var l=this.groups[k];var c=this.progress.button;for(var g=0;g<l.elements.length;g++){var b=l.elements[g];var m=function(){allow_progress(l,c)};if(!b.validation_lives){b.live_validation(m)}}};Form_Widget.prototype.progress_button=function(a){this.progress.button=this.format_element(a)};Form_Widget.prototype.enable_progress_button=function(){var a=this;var b;var c;$(a.progress.button).click(function(){b=a.groups[a.group].div;a.group++;c=a.groups[a.group].div;$(b).hide("slide",{direction:"left"},250,function(){$(c).show("slide",{direction:"right"},250);if(typeof a.progress.bar!=="undefined"){a.animate_progress_bar()}});$(this).hide()});$(this.progress.button).hide()};Form_Widget.prototype.name_swap=function(c){var a;for(a in this.swap_char_map){if(typeof this.swap_char_map[a]==="string"){var b=new RegExp(a);if(b.test(c)){return c.replace(b,this.swap_char_map[a])}}}return c};Form_Widget.prototype.create_form=function(b,e){var a=this;var j;var d=document.createElement("form");if(typeof b!=="undefined"){d.id=b}if(typeof e!=="undefined"){d.className=e}d.setAttribute("method",this.method);d.setAttribute("action",this.handler);if(this.groups.length===0){for(j in this.fields){var h=this.fields[j];if(typeof h==="object"){d.appendChild(h)}}}else{for(var i in this.groups){var c=this.groups[i];if(typeof c==="object"){d.appendChild(c.div)}}this.group=0;$(this.groups[this.group].div).show("slide",{direction:"right"},250);this.enable_progress_button();if(this.progress.end===0){this.progress.end=this.groups.length}this.initialize_progress()}$("input[type=text]",d).one("focus",function(){$(this).val("")});this.element.appendChild(d);$(".swap.focus").hide();$(".swap.default").one("focus",function(){var f=this.name;var g=a.name_swap(f);$(this).remove();$("input[name="+g+"]").show().focus();return false})};Form_Widget.prototype.format_element=function(a){if(typeof a==="object"){return a}if(a[0]!=="#"){a="#"+a}return $(a)};Form_Widget.prototype.set_ajax=function(a,b){if(a===true){$("form",this.element).submit(function(){var c={success:b};$(this).ajaxSubmit(c);return false})}else{$("form",this.element).unbind("submit")}};Form_Widget.prototype.track_progress=function(b,a){this.progress={container:b,bar:a,speed:250,tracking:true,start:0,current:1,end:0}};Form_Widget.prototype.animate_progress_bar=function(){var a=100;this.progress.current++;var c=this.progress.speed;var b=Math.floor((this.progress.current/this.progress.end)*a);$(this.progress.bar).animate({width:b+"%"},c);if(this.group===this.groups.length-1){$(this.progress.button).hide()}$(this.instructions).hide("slide",{direction:"left"},150)};Form_Widget.prototype.initialize_progress=function(){var a=this.progress.start;$(this.progress.bar).css({width:a+"%"})};Form_Widget.prototype.add_instructions=function(a,b){this.field_instructions[a]=b};Form_Widget.prototype.field_index=function(b){for(var a=0;a<this.fields.length;a++){if(this.fields[a].model.name===b){return a}}return undefined};Form_Widget.prototype.add_text=function(b,c){var a=this.field_index(b);var d=document.createElement("div");d.innerHTML=c;d.appendChild(this.fields[a]);d.name=this.fields[a].name;$(d).addClass("form flavor");this.fields[a]=d};Form_Widget.prototype.set_instructions=function(c){var b=this;var a;var d;c=this.format_element(c);$.each(this.fields,function(g,f){$.each(f.input,function(i,h){$(h).focus(function(){a=f.name;$(c).hide("slide",{direction:"left"},b.ANIMATION_SPEED,function(){$(this).empty().text(b.field_instructions[a]);$(this).show("slide",{direction:"right"},b.ANIMATION_SPEED)})})})})};