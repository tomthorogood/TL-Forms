String.prototype.toTitleCase=function(){var a=/^(a|an|and|as|at|but|by|en|for|if|in|of|on|or|the|to|vs?\.?|via)$/i;return this.replace(/([^\W_]+[^\s\-]*) */g,function(c,e,b,d){if(b>0&&b+e.length!==d.length&&e.search(a)>-1&&d.charAt(b-2)!==":"&&d.charAt(b-1).search(/[^\s\-]/)<0){return c.toLowerCase()}if(e.substr(1).search(/[A-Z]|\../)>-1){return c}return c.charAt(0).toUpperCase()+c.substr(1)})};function Parse(a){if(/::/.test(a)){return a.split(/::/g)}return[a,a]}function Form(){this.parse={value:function(a){return Parse(a)[0]},display:function(a){return Parse(a)[1]},selected:function(a){return Parse(a)[2]}}}Form.prototype.IE_Compliant=function(a){if(navigator.appName==="Microsoft Internet Explorer"){var b=document.createElement("div");b.name=a.name;b.appendChild(a);return b}return a};Form.prototype.create_text_field=function(a,c,b){if(typeof a==="undefined"){a="text_field"}var d=document.createElement("input");d.type="text";d.name=a;d.value=c||undefined;if(typeof b==="string"){$(d).addClass(b)}return d};Form.prototype.create_dropdown_menu=function(b,a,d,f){var h=document.createElement("select");if(typeof b==="undefined"){b="dropdown"}h.name=b;for(var e in a){if(typeof e!=="undefined"){var g=a[e];if(!f||typeof f==="undefined"){g=g.replace(/_/g," ").toTitleCase()}var c=document.createElement("option");c.value=this.parse.value(g);c.innerHTML=this.parse.display(g);h.appendChild(c)}}if(typeof d==="string"){$(h).addClass(d)}return h};Form.prototype.create_password_field=function(a,c,b){if(typeof a==="undefined"){a="password"}var d=document.createElement("input");d.type="password";d.name=a;if(typeof c==="string"){d.value=c}if(typeof b==="string"){$(d).addClass(b)}return this.IE_Compliant(d)};Form.prototype.create_submit_button=function(a,d,c,e){var b;if(typeof d==="undefined"){d="Submit"}if(typeof e==="undefined"){b=document.createElement("input");b.type="submit";b.value=d}else{b=document.createElement("input");b.type="image";b.src=e}if(typeof c==="string"){$(b).addClass(c)}b.name=a||"submit";return this.IE_Compliant(b)};Form.prototype.create_fake_button=function(b,d,c){var a=document.createElement("span");if(typeof c==="string"){$(a).addClass(c)}if(typeof b==="string"){a.name=b}a.innerHTML=d;return this.IE_Compliant(a)};Form.prototype.create_hidden_field=function(a,c){var b=document.createElement("input");b.type="hidden";b.name=a;b.value=c;return b};Form.prototype.create_file_upload=function(b,c){var a=document.createElement("input");a.type="file";a.name=b;if(typeof c==="string"){$(a).addClass(c)}return this.IE_Compliant(a)};Form.prototype.create_link_button=function(d,a,b){var c=document.createElement("a");if(typeof a==="undefined"){a="#"}c.href=a;if(typeof b==="string"){$(c).addClass(b)}c.innerHTML=d;return this.IE_Compliant(c)};Form.create_textarea=function(b,d,c){var a=document.createElement("textarea");if(typeof b==="undefined"){b="textarea"}if(typeof c==="string"){$(a).addClass(c)}if(typeof d==="string"){a.innerHTML=d}return this.IE_Compliant(a)};Form.prototype.create_multi_button=function(c,i,b,g){var a=document.createElement("div");var h;a.name=c;for(h in i){if(typeof h==="string"){var f=document.createElement("div");var j=document.createElement("span");if(typeof b==="string"){$(f).addClass(b)}var e=document.createElement("input");if(typeof c==="undefined"){c=g}e.name=c;e.type=g;e.value=this.parse.value(i[h]);if(this.parse.selected(i[h])==="Selected"){e.checked="checked"}j.innerHTML=this.parse.display(i[h]);f.appendChild(e);f.appendChild(j);a.appendChild(f)}}return a};Form.prototype.create_radio_button=function(b,a,c){return this.create_multi_button(b,a,c,"radio")};Form.prototype.create_checkbox=function(b,a,c){return this.create_multi_button(b,a,c,"checkbox")};function validator(b,a,d,c){this.delay=a||650;this.css={valid:d||{"background-color":"#00afad",color:"#fff"},invalid:c||{"background-color":"#811",color:"#fff"}};this.test=b;this.set_text={};this.validate=function(f){var e=this;var g;$(f).keyup(function(){$(f).keydown(function(h){if(h.keyCode!==9){clearTimeout(g)}});if(f.value.length>0){g=setTimeout(function(){var i=e.test(f.value);switch(typeof i){case"object":e.set_text[f.name]=i[1].toString();i=i[0];case"boolean":var h=i?e.css.valid:e.css.invalid;break;default:i=true}switch(typeof f){case"string":f=f[0]==="#"?f:"#"+f;case"object":$(f).animate(h,250,function(){if(typeof e.set_text[f.name]==="string"){$(f).val(e.set_text[f.name]);delete e.set_text[f.name]}});return;case"undefined":return i}},e.delay)}})}}function form_widget(d,c,b,a){if(!b===true){this.overlay=new Overlay();this.element=this.overlay.div}else{this.element=a}this.form=new Form();this.method=d;this.handler=c;this.fields=[];this.groups=[];this.validation_timeout=500;this.field_instructions={};this.valid={email:new validator(function(h){var g=/[A-Za-z0-9%._\-]*@[A-Zz-z0-9\-]*\.[a-zA-Z0-9]{2,4}/gi;var f;var e;if(g.test(h)){f=true}switch(f){case true:return true;case false:return[false,"That email address already exists in our system."];default:return false}}),day_in_month:new validator(function(e){return(typeof e==="number"&&e<32)}),currency:new validator(function(h){var g=/^\$?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}[0-9]{0,}(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/;if(g.test(h)){var f=/[$,]/g;var e=h.replace(f,"");return[true,e]}else{return g.test(h)}}),match:new validator(function(f){var e=document.getElementsByName("password1");if(e.length>0){return f===$(e[0]).val()}else{return true}}),percentage:new validator(function(h){var g=/^[0-9]{0,2}\.{0,1}[0-9]{0,2}%{0,1}/;var e=/^(\.(\d*))/;if(e.test(h)){return true}else{if(g.test(h)){var f=parseInt(h.replace(/\%/g,""),10);f/=100;return[true,f]}else{return false}}}),password:new validator(function(f){var e=/\\\/\(\)\{\};/g;var g=6;if(!e.test(f)){if(f.length>=g){return true}else{return false}}else{return false}})}}form_widget.prototype.validate=function(b,a){this.valid[a].validate(b)};form_widget.prototype.add_field=function(b,a,d,c,f){var e;switch(b){case"text":e=this.form.create_text_field(a,d,c);break;case"hidden":e=this.form.create_hidden_field(a,d);break;case"password":e=this.form.create_password_field(a,d,c);break;case"dropdown":e=this.form.create_dropdown_menu(a,d,c);break;case"submit":e=this.form.create_submit_button(a,d,c);break;case"radio":e=this.form.create_radio_button(a,d,c)}if(typeof f!=="undefined"){this.validate(e,f)}this.fields.push(e)};form_widget.prototype.grouping=function(c,a){var d;var b;var e=document.createElement("div");$(e).addClass("form group");if(typeof c==="string"){e.id=c}else{console.warn("You have given an invalid argument to 'group_id' in form_widget.grouping");console.debug(c)}for(b in a){if(typeof a[b]==="string"){for(d in this.fields){if(typeof this.fields[d]!=="undefined"){if(this.fields[d].name===a[b]){e.appendChild(this.fields[d]);$(e).hide()}}}}}this.groups.push(e)};form_widget.prototype.progress_button=function(a){this.progress.button=this.format_element(a)};form_widget.prototype.enable_progress_button=function(){var a=this;$(a.progress.button).click(function(){$(a.groups[a.group]).hide("slide",{direction:"left"},250,function(){a.group++;$(a.groups[a.group]).show("slide",{direction:"right"},250);if(typeof a.progress.bar!=="undefined"){a._progress()}})})};form_widget.prototype.create_form=function(a,d){var i;var c=document.createElement("form");if(typeof a!=="undefined"){c.id=a}if(typeof d!=="undefined"){c.className=d}c.setAttribute("method",this.method);c.setAttribute("action",this.handler);if(this.groups.length===0){for(i in this.fields){var e=this.fields[i];if(typeof e==="object"){c.appendChild(e)}}}else{for(var h in this.groups){var b=this.groups[h];if(typeof b==="object"){c.appendChild(b)}}this.group=0;$(this.groups[this.group]).show("slide",{direction:"right"},250);if(typeof this.progress.button==="undefined"){console.warn("You have not set a progress button! Users will not be able to use this form! Just call widget.progress_button('element_name')")}else{this.enable_progress_button()}if(this.progress.end===0){this.progress.end=this.groups.length}this.initialize_progress()}$("input[type=text]",c).one("focus",function(){$(this).val("")});this.element.appendChild(c);$(".swap.focus").hide();$(".swap.default").one("focus",function(){var f=$(this).attr("name");$("input[name="+f.replace("x","d")+"]").show().focus();$(this).remove()})};form_widget.prototype.format_element=function(a){if(typeof a==="object"){return a}if(a[0]!=="#"){a="#"+a}return $(a)};form_widget.prototype.set_ajax=function(a,b){if(a===true){$("form",this.element).submit(function(){var c={success:b};$(this).ajaxSubmit(c);return false})}else{$("form",this.element).unbind("submit")}};form_widget.prototype.track_progress=function(b,a){this.progress={container:b,bar:a,speed:250,tracking:true,start:0,current:1,end:0}};form_widget.prototype._progress=function(){var a=100;this.progress.current++;var c=this.progress.speed;var b=Math.floor((this.progress.current/this.progress.end)*a);$(this.progress.bar).animate({width:b+"%"},c);if(this.group===this.groups.length-1){$(this.progress.button).hide()}$(this.instructions).hide("slide",{direction:"left"},150)};form_widget.prototype.initialize_progress=function(){var a=this.progress.start;$(this.progress.bar).css({width:a+"%"})};form_widget.prototype.add_instructions=function(a,b){this.field_instructions[a]=b};form_widget.prototype.set_instructions=function(b){var a=this;if(typeof b==="string"){if(typeof document.getElementById(b.replace(/#/,""))==="undefined"){this.instructions=document.createElement("div");this.instructions.id=b.replace(/#/,"");b=this.instructions}else{b=document.getElementById(b.replace(/#/,""));this.instructions=b}}if(this.groups.length===0){var d;$.each(this.fields,function(g,f){$(f).focus(function(){var e=$(f).attr("name");$(b).hide("slide",{direction:"left"},150,function(){$(this).empty().text(a.field_instructions[e]);$(this).show("slide",{direction:"right"},150)})})})}else{var c;for(c in this.groups){$(this.groups[c]).children().each(function(){$(this).focus(function(){var e=this.name;$(b).hide("slide",{direction:"left"},150,function(){$(this).empty().html(a.field_instructions[e]);$(this).show("slide",{direction:"right"},150)})})})}}};